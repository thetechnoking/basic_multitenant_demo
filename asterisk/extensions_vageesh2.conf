
; Auto-generated configuration for Tenant: vageesh2

[inbound-vageesh2]
exten => +189338888767,1,NoOp(Inbound call for vageesh2)
same => n,Answer()
same => n,Playback(welcome)
same => n,Hangup()

[outbound-vageesh2]
exten => _X.,1,NoOp(Outbound call from vageesh2)
; 1. Run AGI Check (Node.js Service)
same => n,Set(CDR(recname)=recording)
same => n,Set(CDR(tenant)=vageesh2)
same => n,Set(recording=vageesh2/${CALLERID(num)}_${EXTEN}_${EPOCH}.wav)
same => n,AGI(agi://localhost:4573, ${CALLERID(num)}, ${EXTEN})

; 2. Check Permission
same => n,GotoIf($["${IS_ALLOWED}" = "false"]?deny)

; 3. Routing Logic based on Target Type (INTERNAL vs EXTERNAL)
same => n,GotoIf($["${TARGET_TYPE}" = "INTERNAL"]?dial_internal)
same => n,GotoIf($["${TARGET_TYPE}" = "EXTERNAL"]?dial_external)
same => n,Goto(deny)

; --- INTERNAL CALL (Extension to Extension) ---
same => n(dial_internal),NoOp(Internal Call Detected)
same => n,MixMonitor(${recording},ab)
same => n,Dial(PJSIP/${EXTEN},30)
same => n,Hangup()

; --- EXTERNAL CALL (To Trunk) ---
same => n(dial_external),NoOp(External Call Detected)
same => n,MixMonitor(${recording},ab)
same => n,Dial(PJSIP/${EXTEN}@test,60)
same => n,Hangup()

; --- DENIED ---
same => n(deny),NoOp(Call Denied)
same => n,Playback(ss-noservice)
same => n,Hangup()
