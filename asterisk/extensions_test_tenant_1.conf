
; Auto-generated configuration for Tenant: test_tenant_1

[inbound-test_tenant_1]
exten => +18899887712,1,NoOp(Inbound call for test_tenant_1)
same => n,Answer()
same => n,Playback(welcome)
same => n,Hangup()

[outbound-test_tenant_1]
exten => _X.,1,NoOp(Outbound call from test_tenant_1)
; 1. Run AGI Check (Node.js Service)
same => n,Set(CDR(tenant)=test_tenant_1)
same => n,AGI(agi://localhost:4573, ${CALLERID(num)}, ${EXTEN})

; 2. Check Permission
same => n,GotoIf($["${IS_ALLOWED}" = "false"]?deny)

; 3. Routing Logic based on Target Type (INTERNAL vs EXTERNAL)
same => n,GotoIf($["${TARGET_TYPE}" = "INTERNAL"]?dial_internal)
same => n,GotoIf($["${TARGET_TYPE}" = "EXTERNAL"]?dial_external)
same => n,Goto(deny)

; --- INTERNAL CALL (Extension to Extension) ---
same => n(dial_internal),NoOp(Internal Call Detected)
same => n,MixMonitor(test_tenant_1/${CALLERID(num)}_${EXTEN}_${EPOCH}.wav,ab)
same => n,Dial(PJSIP/${EXTEN},30)
same => n,Hangup()

; --- EXTERNAL CALL (To Trunk) ---
same => n(dial_external),NoOp(External Call Detected)
same => n,MixMonitor(test_tenant_1/${CALLERID(num)}_${EXTEN}_${EPOCH}.wav,ab)
same => n,Dial(PJSIP/${EXTEN}@twilio,60)
same => n,Hangup()

; --- DENIED ---
same => n(deny),NoOp(Call Denied)
same => n,Playback(ss-noservice)
same => n,Hangup()
